\cslang
\margins/1 a4 (20,,,)mm
\fixmnotes\right
\fontfam[schola]
\def\TODO{{\Red TODO}}
\verbchar`
\everytt{\typosize[9/]\catcode`<=13 }
\everyintt{\catcode`<=13 \Magenta}
\catcode`<=13 \def<#1>{{$\langle$\it#1$\rangle$}}

\tit OP-Bible -- zpracování komentovaných biblí \TeX/em

OP-Bible je sada nástrojů (maker a dalšího podpůrného softwaru) na
zpracování biblických textů. Hlavním cílem je umožnit navázat na z internetu
stažené úplné texty Bible a propojit je s doplněnými poznámkami podle
požadovaných kritérií popsaných níže. Výsledkem po zpracování \TeX/em je
komentovaná Bible, tj. Bible vytištěná společně s poznámkami. PDF soubor je
navíc bohatě prolinkovaný hypertextovými odkazy.

Úplný text Bible je na internetu k dispozici v různých překladech a české
překlady jsou nejméně čtyři. Je možné si stáhnout třeba jen jeden překlad
(dále mu říkáme \uv{základní text}) a doplňovat jej poznámkami, které
zapisujeme do přidružených souborů tak, že není nutná žádná editace či jiný
zásah do základního textu. Je též možné poznámky psát tak, že jsou víceméně
univerzální například pro kterýkoli z českých překladů, takže pozměněním jen
výchozí konfigurace v hlavním souboru zpracování \TeX/ načte jiný základní
text se stejnými poznámkami, které se navíc automaticky modifikují podle
vyjadřovacích zvyklostí toho kterého překladu.

Pro zpracování \TeX/em je tedy třeba mít odpovídající verzi základního textu
(předzpracovanou způsobem, popsaným v sekci~\ref[zakladni]) a dále soubory s
poznámkami (jejich syntaxe je uvedena v sekcích \ref[note] a \ref[glosy]).
\TeX/ přečte hlavní soubor se základními pokyny, pak načte data všech
potřebných souborů a vytvoří PDF knihy -- komentované Bible. V ní je jednak
(typicky větším písmem) základní text a (typicky menším písmem, například
pod čarou a třeba ve dvou sloupcích) poznámky k textu. Je respektován
základní požadavek, že k jednotlivým frázím základního textu jsou poznámky
umístěny na stejné stránce jako samotné fráze základního textu. O rozmístění
objektů na stránkách se \TeX/ stará víceméně automaticky podle nastavených
typografických pravidel, které se dají modifikovat dle potřeby. Požadavky na
typografickou úpravu nebo další specifické požadavky, které se dají
algoritmicky popsat, jsou implementovány makry \TeX/u a \TeX/ je během
zpracování přečte a automaticky provede.

Veškerá data, která \TeX/ zpracovává (konfigurace, základní text, texty
poznámek, maker) mají textový formát, tj. dají se prohlížet a případně
upravovat běžným textovým editorem.


\sec[zakladni] Formát základního textu

Předpokládá se, že základní text Bible je uložen v souborech s příponou `.txs`
(text source). Každá z~66~knih Bible je uložena ve svém `.txs` souboru.
Názvy `.txs` souborů je možné deklarovat pomocí příkazu `\def\txsfile` v
hlavním souboru (viz~sekci~\ref[hlavni]). Název `.txs` souboru by měl obsahovat
jednak značku použitého překladu Bible a dále zkratku knihy. Například
`CzeBKR-Da.txs` obsahuje základní text překladu Bible Kralické, knihy
Daniel.

Každý řádek `.txs` souboru obsahuje jeden verš Bible uvozený 
`#<číslo-kapitoly>:<číslo-verše>`. Verše musejí být uvedeny ve správném
pořadí. Například začátek souboru `CzeBKR-Da.txs` vypadá takto (části textu
jsou v ukázce vynechány):

\begtt
#1:1 Léta třetího kralování Joakima krále Judského, ... a oblehl jej.
#1:2 I vydal Pán v ruku jeho Joakima ... do domu pokladu boha svého.
...
\endtt

Základní texty Bible lze získat například z modulů Swordu
\url{https://www.crosswire.org/sword/modules/ModDisp.jsp?modType=Bibles}.
Jednotlivé `.txs` soubory je pak možné vygenerovat následujícím postupem.

ZIP stažený z uvedené www stránky (tzv modul) někam rozbalte. Je třeba
mít dále v počítači instalován balíček `libsword-dev` a dále program
`mod2tex`, který je součástí OP-Bible. Pomocí `installmgr -l` zjistíte
seznam stažených modulů. Máte-li nastaven aktuální adresář v místě, kam jste
rozbalili ZIPy a vznikl tam adresář `modules`, pak jsou takové moduly
nalezeny. Moduly obsahují texty v binárním formátu, my je potřebujeme
převíst do textového formátu. K tomu stačí napsat do příkazového řádku: 
\begtt 
mod2tex modul > soubor
\endtt 
kde `modul` je název modulu. Ve výsledném souboru
máte kompletní základní text daného překladu (modulu).
Například po
\begtt
mod2tex CzeBKR > CzeBKR.out
\endtt
je v souboru `CzeBKR.out` kompletní překlad Bible Kralické.
Ten nyní můžete rozdělit do `.txs` souborů příkazem
\begtt
maketxs CzeBKR.out
\endtt
Uvedený příkaz kromě 66 `.txs` souborů vytvoří soubor `CzeBKR-books.tex`, ve
kterém jsou tituly a zkratky jednotlivých knih, tedy je tam:
\begtt
\BookTitle Gen Gen {Genesis}
\BookTitle Exod Exod {Exodus}
\BookTitle Lev Lev {Leviticus}
\BookTitle Num Num {Numbers}
\BookTitle Deut Deut {Deuteronomy}
\BookTitle Josh Josh {Joshua}
\BookTitle Judg Judg {Judges}
...
\endtt
Tyto tituly nejsou v češtině, protože je zdroj Sword neobsahuje. Je tedy
třeba tento soubor manuálně upravit a vložit místo anglických české názvy.
Zkratky knih jsou uvedeny dvakrát stejně. První ponechte a druhou zkratku 
můžete pozměnit podle zvyklostí českého jazyka, viz též sekci~\ref[hlavni].

Jednotlivé `.txs` soubory můžete vložit do
separátního adresáře projektu, například s názvem `sources/`. 
Odtud si je \TeX/ bude číst, pokud mu jejich umístění oznámíte v konfiguraci
v hlavním souboru, viz sekci~\ref[hlavni]. Se soubory nadále nebudete
potřebovat nijak manipulovat, není potřebné je editovat ani doplňovat. V
adresáři `sources/` tedy můžete mít \uv{datový sklad} všech základních textů
Bible pro všechny použité překlady najednou.


\sec[note] Formát poznámek s vazbou na fráze v základním textu

Hlavním smyslem nástroje OP-Bible je vytvořit PDF ze základního textu nejen
se samotným textem Bible, ale s propojenými poznámkami. K tomu slouží
mimo jiné soubory `notes-*.tex` (například `notes-Ge.tex` pro knihu Genesis), ve
kterých jsou zapsány poznámky k jednotlivým frázím základního textu dle
následujícího smluveného formátu. Jednotlivá poznámka má tvar:

\begtt
\Note <číslo-kapitoly>:<číslo-knihy> {<fráze>} <text-poznámky> 
<prázdný řádek>
\endtt
Například:
\begtt
\Note 1:2 {nádobí} Odkaz na nádobí z vypleněného chrámu, nikoliv na deportaci zajatců.

\endtt
Příklad je ze souboru `notes-Da.tex`, tedy ze souboru s poznámkami ke knize
Daniel. Konkrétně se poznámka váže na kapitolu první, verš druhý a na frázi
\uv{nádobí}. Tato fráze musí být bezpodmínečně ve stanoveném verši
základního textu obsažena. Pak ji \TeX/ propojí s odpovídajícím místem v
základním textu, tj. zajistí, že výskyt fráze i samotné poznámky je na
společné stránce. 

Povšimněme si, že fráze se váže na překlad Bible Kralické, zatímco v
překladu ekumenickém je použit ve stejném verši termín \uv{nádob}. Jak
zařídit, aby se stejná poznámka automaticky mírně modifikovala podle
použitého překladu, je popsáno v sekci~\ref[ruzne-preklady].

Pokud <fráze> není ve stanoveném verši základního textu doslovně obsažena,
\TeX/ během zpracování oznámí do logu a a na terminál o tom varování a
poznámku zařadí k danému verši, jakoby <fráze> byla na začátku verše..

Vytištěná poznámka (v závislosti na typografickém nastavení) obsahuje
například zopakování čísla kapitoly a verše, pak následuje komentovaná fráze
(například tučně) a za ní je vlastní text poznámky.

Někdy je třeba v základním textu vyhledat mírně jinou frázi, než jakou pak
chceme zapsat do vytištěné poznámky (např. v základním textu je slovo v
jiném pádě nebo je to mírně jinak formulovaná fráze). Pak je možné těsně za
`{<fráze>}` napsat rovnítko následované `{<fráze-k-tisku>}`, tedy

\begtt
\Note <číslo-kapitoly>:<číslo-knihy> {<fráze>}={<fráze k tisku>} <text-poznámky> 
<prázdný řádek>
\endtt
V takovém případě se v základním textu hledá <fráze>, ale ve vlastní
poznámce se vytiskne jako heslo poznámky <fráze-k-tisku>. Například:
\begtt
\Note 1:2 {vydal Pán}={Pán vydal} Porážka Izraele Babylónem není vysvětlitelná
   jen pouhou vojenskou a politickou analýzou oné doby. Bůh vždy jednal svrchovaně 
   v záležitostech národů. Babylóňany použil jako nástroj potrestání svého vlastního
   lidu za porušení smluvních závazků.

\endtt
V tomto příkladě se hledá ve verši druhém základního textu \uv{vydal Pán} 
ale v poznámce je vytištěno heslo \uv{Pán vydal}.

Povšimněte si, že tato poznámka se rovněž váže na verš druhý kapitoly první
knihy Daniel (protože je v souboru `notes-Da.tex`). Je tedy možné mít více
poznámek k různým frázím, které se váží na stejný biblický verš. 

Jednotlivé poznámky ve zdrojovém souboru poznámek jsou odděleny prázdnými
řádky. To je nutné, jinak by \TeX/ při jejich čtení nepoznal, kde končí text
poznámky. Také se tím zvyšuje přehlednost zdrojového souboru. Další řádky
poznámky můžete (ale nemusíte) odsadit. Obecná pravidla pro zápis
zdrojových textů pro \TeX/ nejsou předmětem tohoto manuálu, najdete je v
různých učebnicích k~\TeX/u.

Pokud se poznámka váže k celému verši (tj. bez specifikované fráze), pište
`{}`, tedy prázdnou frázi k vyhledání. Například:
\begtt
\Note 1:1-21 {}={Uchování rituální čistoty}  Prorok uvozuje kontext své knihy vyprávěním
   osobní historie (své i svých přátel) zajetí, vzdělání, věrnosti Bohu a služby 
   králi Nabuchodonozorovi.
\endtt
Tato ukázka navíc demonstruje, že je také možné uvést celý rozsah čísel veršů.
Je-li <fráze> pro vyhledání prázdná (jako v tomto příkladě), pak se poznámka
umístí na stejnou stranu, kde je začátek prvního verše z uvedeného rozsahu.
Je-li <fráze> neprázdná, musí se vyskytovat v prvním verši z uvedeného
rozsahu veršů. Rozsah veršů bude stejně vytištěn v úvodu poznámky.
Symbol pro rozsah „`-`“ je jediný znak \uv{mínus} běžně dosažitelný na
klávesnici. Nesmí to být žádný speciální znak vypadající třeba podobně jako
vodorovná čárka.



\sec[glosy] Formát dalších vložených poznámek (glosy, články)

\TODO...

\sec[fmt] Údaje určující formátování základního textu

Základní text v `.txs` souborech neobsahuje
žádné formátovací ani doplňkové údaje, jakými jsou například názvy kapitol
nebo místa, kde se má ukončit odstavec či přejít z formátování v bloku do
formátování na střed řádků a zpět.

\mnote{\code{\\fmtadd} \code{\\fmtpre} \code{\\fmtins}}
Potože do základního textu nechceme nijak zasahovat, je třeba tyto doplňkové
údaje deklarovat k příslušným veršům pomocí speciálních příkazů `\fmtadd`,
`\fmtpre` a `\fmtins`. Tyto příkazy jsou typicky v souborech `fmt-*.tex`,
například `fmt-BKR-Da.tex`. Je vhodné udržovat tyto formátovací soubory
závislé jednak na knize (Daniel v uvedené příkladu), ale také na použitém
překladu (Bible Kralická v příkladu). Je sice možné začít s jedním souborem
pro každou knihu a soubory pro ostatní překlady pořídit jako kopie výchozích,
ale nakonec bude asi potřebné pro rozličné varianty základního textu
formátovací pokyny mírně modifikovat v souladu s použitým překladem.

Syntaxe použití uvedených příkazů je následující:
\begtt
\FormatedBook{<zkratka-knihy>}
\fmtpre{<číslo-kapitoly>:<číslo-verše>}{<fmt-pokyn>}
\fmtadd{<číslo-kapitoly>:<číslo-verše>}{<fmt-pokyn>}
\fmtins{<číslo-kapitoly>:<číslo-verše>}{<fráze>}{<fmt-pokyn>}
\endtt
Na začátku souboru nebo skupiny
příkazů `\fmt*` je třeba nejprve deklarovat pomocí `\FormatedBook`, které
biblické knihy se formátování týká, protože v prvním parametru příkazů `\fmt*` je už
jen uvedeno číslo kapitoly a číslo verše. 

<fmt-pokyn> je \uv{vzkaz}, který je předán \TeX/u k formátování.
\mnote{\code{\\endgraf} \code{\\begcenter} \code{\\endcenter}}
Například `\endgraf` značí konec odstavce. `\begcenter` otvírá pasáž s
centrovaným textem a ta musí být uzavřena pomocí `\endcenter`. Nebo 
`\chaptit{<text>}` vloží <text> jako titul kapitoly.

\mnote{\code{\\fmtadd} \code{\\fmtpre} \code{\\fmtins}}
Příkaz `\fmtpre` vkládá <fmt-pokyn>
na začátek uvedeného verše (ještě před případně vytištěné číslo verše horním
indexem). Příkaz `\fmtadd` vkládá <fmt-pokyn> na konec uvedeného verše.
Konečně `\fmtins` vkládá <fmt-pokyn> dovnitř verše za první výskyt stanovené
<fráze>, která ve verši musí doslovně existovat. Jinak \TeX/ vypíše varování
a <fmt-pokyn> nezařadí vůbec.

Jak může vypadat použití příkazů `\fmt*` je vidět například v souboru
`fmt-BKR-Da.tex`.


\sec[ruzne-preklady] Různé (ale podobné) verze základního textu

Existuje například více českých překladů Bible, které používají různé zvyklosti pro
vyjádření některých frází. Máme tedy různé varianty základního textu a
chceme k nim připojit společný poznámkový aparát, ve kterém se budou
označené fráze automaticky měnit podle zvoleného překladu. K tomu slouží příkazy
popsané v této sekci.

\secc Deklarace variant překladu a použití pomocí příkazu `\x`

\mnote{\code{\\vdef} \code{\\x}}
Nejsou-li varianty deklarovány příkazem `\vdef` (viz níže), pak
příkaz `\x/<fráze>/` použitý v textu vypíše <fráze>. Je ovšem možné
deklarovat varianty překladu
\mnote{\code{\\variants}}%
pomocí

\begtt
\variants <počet-variant> {<varianta-A>} {<varianta-B>} {<varianta-C>} {<varianta-D>}
\endtt
(zde `<varianta-D>` nemusí být poslední, počet parametrů je určen hodnotou
`<počet-variant>`). Tyto parametry jsou značkami pro konkrétní překlad, např.
`CzeBKR` pro překlad podle Bible Kralické nebo `CzeCEP` pro ekumenický překlad.

Následně je možné definovat varianty frází pro jednotlivé varianty překladu:
\begtt
\vdef {<fráze-A>} {<fráze-B>} {<fráze-C>} {<fráze-D>}
\endtt
Zde musí být stejný počet parametrů pro fráze jako je `<počet-variant>` uvedený v
předchozím příkazu `\variants`.
Pokud je nyní v hlavním souboru například
\mnote{\code{\\tmark}}
uvedeno:
\begtt
\def\tmark {<varianta-C>}
\endtt
pak `\x/<fráze-A>/` se promění na <fráze-C>.

Je-li ovšem v hlavním souboru
definováno `\def\tmark {<varianta-A>}`, pak `\x/<fráze-A>/` vypíše
`<fráze-A>`, jako kdyby žádné varianty překladu nebyly deklarovány.

Ilustrujme si toto na příkladu. Předpokládejme, že máme soubor `vars.tex`,
který je čten z hlavního souboru pomocí `\input` a soubor obsahuje:

\begtt
\variants 3 {CzeBKR}         {CzeCEP}       {CzeCSP}
\vdef       {Baltazar}       {Beltšasar}    {Beltšasar}
\vdef       {Nabuchodonozor} {Nebúkadnesar} {Nebúkadnesar}
\vdef       {sedm let}       {sedm let}     {sedm časů}
\endtt

Je-li v hlavním souboru `\def\tmark{CzeBKR}`, pak
\begtt
\x/Baltazar/        vypíše Baltazar
\x/Nabuchodonozor/  vypíše Nabuchodonozor
\x/sedm let/        vypíše sedm let
\x/cokoli/          vypíše cokoli
\endtt

Je-li ale v hlavním souboru `\def\tmark{CzeCEP}`, pak
\begtt
\x/Baltazar/        vypíše Beltšasar
\x/Nabuchodonozor/  vypíše Nebúkadnesar
\x/sedm let/        vypíše sedm let
\x/cokoli/          vypíše cokoli a na terminálu bude varování,
                                  že fráze /cokoli/ nemá deklarován překlad.
\endtt
Například poznámka v knize Daniel uvedená
v~sekci~\ref[note] by mohla znít:
\begtt
\Note 1:1-21 {}={Uchování rituální čistoty}  Prorok uvozuje kontext své knihy vyprávěním
   osobní historie (své i svých přátel) zajetí, vzdělání, věrnosti Bohu a služby 
   králi \x/Nabuchodonozor/ovi.
\endtt
a tato poznámka při `\def\tmark{CzeCEP}` na svém konci zní
\uv{\dots a služby králi Nebúkadnesarovi}, zatímco při
`\def\tmark{CzeBKR}` zní \uv{\dots a služby králi Nabuchodonozorovi}.

\secc Variantní deklarace frází pro spárování poznámek s textem

\mnote{\code{\\\wdef}}
Kromě `\vdef`, což deklaruje varianty překladu platné pro celou Bibli je
možné použít `\wdef`, což deklaruje varianty překladu jen pro konkrétní verš
konkrétní knihy a jen pro spárování poznámek `\Note` s výchozím textem.
Syntaxe je následující:
\begtt
\CommentedBook {<zkratka-knihy>}
\wdef <číslo-kapitoly>:<číslo-verše> {<fráze-A>} {<fráze-B>} {<fráze-C>}
\endtt
kde počet parametrů pro fráze se musí shodovat s hodnotou `<počet-variant>` v
příkazu `\variants`.

Pro každý příkaz `\Note`:
\begtt
\Note <číslo-kapitoly>:<číslo-verše> {<fráze>} <text-poznámky>
\endtt
se před vyhledáním `<fráze>` ve stanoveném verši tato `<fráze>`
automaticky promění podle aktuální varianty `\tmark` překladu následujícím způsobem:
\begitems
* Je-li `<fráze>` deklarována jako `<fráze-A>` pomocí `\wdef` pro konkrétní
  verš, použije se místo ní odpovídající variantní fráze, jinak
* je-li `<fráze>` deklarována jako `<fráze-A>` pomocí `\vdef`,
  použije se místo ní odpovídající variantní fráze bez ohledu na knihu a číslo verše,
* jinak se použije pro vyhledání v textu přímo `<fráze>`.
\enditems

Variantní fráze deklarované pomocí `\wdef` mají také rozšířenou syntaxi: může
těsně následovat rovnítko a `{<fráze-pro-tisk>}`. Takže například na poznámku
`\Note` uvedenou sekci~\ref[note] může navazovat deklarace `\wdef` takto:
\begtt
\CommentedBook {Da}
\wdef 1:2 {vydal Pán} {Hospodin mu vydal}={Hospodin vydal} {Hospodin vydal}
\endtt
Tento příklad funguje následovně: Při zpracování první varianty základního textu
(překlad CzeBKR v~našem příkladě) se vyhledává \uv{vydal Pán} a tiskne se \uv{Pán vydal}
(odlišná fráze pro tisk je přímo v parametru `\Note`). Při
zpracování druhé varianty základního textu se vyhledá \uv{Hospodin mu vydal}
a vytiskne se v poznámce \uv{Hospodin vydal} a konečně při zpracování třetí
varianty se vyhledá \uv{Hospodin vydal} a vytiskne se též 
\uv{Hospodin vydal}, protože třetí varianta nemá těsně následované rovnítko
s odlišnou frází pro tisk.  

Je-li `<fráze-pro-tisk>` deklarována jednak v parametru `\Note` a jednak
pomocí `\wdef`, má přednost údaj z `\wdef`.

\secc Větvení zpracování textu podle variant překladu

\mnote{\code{\\switch}}
Pomocí příkazu `\switch` můžete větvit zpracování vstupního textu v
závislosti na nastavené hodnotě parametru `\tmark`, tedy v závislosti na
aktuálně zpracovávané variantě jazyka. Příkaz má tuto syntaxi:
\begtt
\switch {<seznam variant>} {<co provést>}%
        {<seznam variant>} {<co provést>}% ... atd
        {<seznam variant>} {<co provést>}
\endtt
Dvojic `{<seznam variant>}{<co provést>}` může být uvedeno libovolně mnoho.
Za každou dvojicí `{<seznam variant>}{<co provést>}` (s výjimkou poslední
dvojice) musí bezprostředně a bez mezer následovat další taková dvojice,
proto je nutné při přechodu na
další řádek napsat za uzavírací závorku procento, které zakryje mezeru z
konce řádku. Mezery na začátku dalšího řádku nevadí.
Proceto za dvojicí můžete číst jako \uv{pokračuje další dvojice}.

`<seznam variant>` je
jedna překladová varianta nebo seznam překladových variant oddělených
čárkou a bez mezer. \TeX/ pak pracuje takto: vyskytuje-li
se v `<seznam variant>` varianta definovaná v parametru `\tmark`, provede se
následující `<co provést>`. Nevyskytuje-li se tam taková varianta,
následující `<co provést>` se přeskočí. Příklad:
\begtt
\switch {CzeBKR} {Balsazar}%
        {CzePSP} {Bélšaccar}%
        {CzeCSP,CzeCEP,CzeB21,CzeSNC} {Belšasar}
\endtt
Příklad ukazuje, jak vytisknout slovo Balsazar v závislosti na
zpracovávané variantě jazyka.

\mnote{\code{\\smark}}
Pokud je kromě `\tmark` definována ještě
zkratka pro variantu jazyka `\smark` (například pomocí `\def\smark{CEP}`),
pak je možné v `<seznam variant>` používat také tyto zkratky, takže předchozí
příklad  by mohl vypadat následovně:
\begtt
\switch {BKR}  {Balsazar}%
        {PSP}  {Bélšaccar}%
        {CSP,CEP,B21,SNC} {Belšasar}
\endtt
Jakmile \TeX/ najde shodu a provede `<co provést>`, pak případné následující
údaje v rámci stejného příkazu `\switch` přeskočí. Dále platí pravidlo, že
pokud je `<seznam vaiant>` prázdný, provede se `<co provést>` vždy, pokud
tedy není přeskočeno dle předchozího pravidla. Takže prázný `<seznam variant>` na
konci dvojic parametrů příkazu `\switch` se vyhodnotí jako \uv{ostatní
případy}. Příklad uvedený výše se tedy dá zapsat také takto:
\begtt
\switch {BKR} {Balsazar}%
        {PSP} {Bélšaccar}%
        {}    {Belšasar}
\endtt

Příkaz `\switch` se dá použít nejen na jednotlivé fráze uvnitř poznámek
`\Note`, ale třeba také na celé úseky vstupního textu obsahující třeba i
několik poznámek `\Note`, několik definic atd.

Příkaz `\switch` se nedá použít v parametrech jiných maker. Tam funguje jen
příkaz `\x/<fráze>/`.

\secc Přečíslování veršů podle variant překladu

\mnote{\code{\\renum}}
Některé varianty překladu mají jiné číslování veršů. V takovém případě je
možné použít příkaz `\renum` takto:

\begtt
\renum <zkratka-knihy> <výchozí-č-kap>:<výchozí-č-verše> = <překlad> <č-kap>:<č-od>-<č-do>
\endtt
kde `<překladu>` je značka pro konkrétní překlad.
Místo `<výchozí-č-kap>:<výchozí-č-verše>` se použije při `\def\tmark{<překlad>}`
ve skutečnosti `<č-kap>:<č-od>`.
Takové přečíslování se netýká jen
tohoto verše, ale celého úseku veršů vymezeného rozsahem `<č-od>-<č-do>`.

Například:
\begtt
\renum Da 4:16 = CzeCEP 4:13-34
\endtt
znamená, že `\Note 4:16 {sedm let} Sedm období neurčené ...` je poznámka,
která ve výchozím překladu <varianta-A> (CzeBKR v našem předchozím příkladě)
se váže na text `sedm let`, který je umístěn skutečně ve verši Da~4:16.
Když ale je `\def\tmark{CzeCEP}`, pak uvedená poznámka `\Note 4:16`
se váže na verš Da~4:13 tohoto překladu, ve kterém je vyhledána fráze
`sedm let`. A k přečíslování dojde i pro následující verše, takže
4:16 dle BKR je 4:13 dle CEP, 4:17 dle BKR je 4:14 dle CEP, atd., až
4:37 dle BKR je 4:34 dle CEP.

Má-li se přečíslování týkat jediného verše, je třeba uvést shodné
`<č-od>` i `<č-do>`, tedy například
\begtt
\renum Da 4:16 = CzeCEP 4:13-13
\endtt

\sec[odkazy] Metody vytváření hyperlinkových odkazů

Odkaz je úsek textu, podle kterého čtenář i po vytištění pozná, na jaké jiné místo
v textu (nebo v~internetu) se může podívat. Obsahuje tedy číselný údaj o
stránce nebo o čísle kapitoly, sekce atd. Navíc, pokud čtenář pracuje s PDF
prohlížečem, pak tento úsek textu je {\em aktivní}, tj. po najetí myším
kurzorem nad tento text je možné klikout a PDF prohlížeč přejde na stanovené
místo v dokumentu (nebo do internetu). Bible je neměnným způsobem
strukturovaný text. Obsahuje 66 knih s ustálenými značkami pro tyto knihy,
každá kniha má své kapitoly číslované od jedné a každá kapitola má verše
číslované od jedné. Není tedy potřeba nechat \TeX/, aby generoval tato čísla
automaticky (jako to dělá při sazbě třeba odborného textu členícího se na
kapitoly a sekce) a není tedy vesměs potřeba používat lejblíky ve zdrojovém
dokumentu (které \TeX/ při zpracování přiřadí k vygenerovaným číslům) a odkazovat pomocí
těchto lejblíků, jak je popsáno v sekci 1.4.3 v dokumentaci \OpTeX/u. Je
daleko účelnější odkazovat přímo do konkrétního místa v Bibli, které má už
po mnohá staletí pevné označení knihy, čísla kapitoly a čísla verše.

\secc Odkazy na verše a poznámky k verši

\mnote{Základní pravidlo}
Tyto odkazy píšeme mezi znaky \code{<} a \code{>}. Text mezi těmito znaky se tiskne jako
aktivní odkaz na konkrétní verš nebo poznámku k verši, ale musí mít předepsaný formát, aby
\TeX/ poznal, na jaký verš má propojit hypertextový odkaz.
Specifikace odkazu má tyto možnosti:

\begitems
* "<text>" <údaj> ... vytiskne se aktivní <text> <údaj>
* <údaj> ... vytiskne se aktivní <údaj>
\enditems
%
`<údaj>` může být zapsán jako
`<kniha> <kapitola>:<verš>`. Zde `<kniha>` je zkratka knihy (za ní musí být
mezera), `<kapitola>` je číslo kapitoly a `<verš>` je číslo verše.
\mnote{Úplný údaj}%
Takovému údaji říkáme {\em úplný údaj}. 
Odkaz s úplným údajem je {\em úplný odkaz}.
Kromě toho mohou existovat neúplné údaje/odkazy, což popíšeme za chvíli.

\mnote{Předsunutý text}
Je-li v odkaze přítomný předsunutý `<text>`, stává se součástí aktivního odkazu,
srovnejte:

\begtt \catcode`<=12
... viz také verš <Jr 8:13>
... viz také <"verš" Jr 8:13>
\endtt
V prvním případě se vytiskne ... viz také verš {\Blue Jr 8:13} a ve druhém
... viz také {\Blue verš Jr 8:13}. Aktivní (umožňující proklik) bude v obou případech
oblast zde vyznačena modře.

\mnote{Neúplný údaj}
Někdy dokáže umístění verše čtenář stanovit z kontextu, takže `<údaj>`
nemusí být úplný. V~{\em neúplném údaji} může chybět `<kniha>` nebo
`<kniha> <kapitola>:`. Například:

\begtt \catcode`<=12
... analogii vidíme též ve <"verších" Jr 8:13>, <9:7> a <11:3>
... viz verše <Jr 8:13>, <15>, <17>
... viz všechny <"verše" Jr 8:13>--<22>.
\endtt
Vytiskne se:
... analogii vidíme též ve {\Blue verších Jr 8:13}, {\Blue 9:7} a {\Blue 11:3}
... viz verše {\Blue Jr 8:13}, {\Blue 15}, {\Blue 17}
... viz všechny {\Blue verše Jr 8:13}--{\Blue 22}.

Údaje `9:7`, `11:3`, `15`, `17` a `22` v těchto příkladech jsou neúplné. Čtenář ví, že se týkají
knihy Jeremjáš a že v případě, kdy není uvedena ani kapitola, se týkají kapitoly 8 knihy
Jeremjáš. Ví to i \TeX/ a přidělí těm neúplným odkazům správné interní
odkazy (podle kterých se provede proklik), protože pracuje podle
následujícího pravidla:
\begitems
* Chybí-li v údaji `<kniha>`, použije se `<kniha>` předchozího naposledy uvedeného úplného
  údaje.
* Chybí-li též `<kapitola>`, použije se kapitola z předchozího naposledy uvedeného údaje, kde je
  číslo kapitoly uvedeno.
\enditems
Předchozí údaje uvedené v těchto pravidlech musejí být v textu
společné poznámky, glosy, atd. Nejsou-li tam, jsou neúplné odkazy 
interpretovány jako \mnote{Lokální údaj}{\em lokální}, tj. proklik vede na
aktuální knihu nebo též (při vynechaném čísle kapitoly) na aktuální
kapitolu. Například v knize Daniel může být poznámka:

\begtt \catcode`<=12
\Note 3:2  {} Analogii vidíme též ve verších <7>, <11> a <13>.
\endtt
a vytisknou se odkazy {\Blue 7}, {\Blue 11} a {\Blue 13} interně směřující na 
Da 3:7, Da 3:11 a Da 3:13.

\mnote{Odkaz uvozený \code{\\}}
Lokální neúplný údaj můžete zapsat také pomocí \code{\\<...>}, tedy
přidáním znaku `\` před otevírací závorku odkazu. Takový údaj je interpretován
jako lokální, ačkoli před ním předchází třeba úplný údaj odkazující na
vzdálené místo v Bibli. Například:
\begtt \catcode`<=12
\Note 4.5 {} Myšlenka se opakuje v <Jr 4:5>. Ale také v \<8:3> najdete o tom zmínku.
\endtt
Zde odkaz {\Blue 8.3} vede na verš 3 kapitoly 8 aktuální knihy. Kdyby tam
znak `\` nebyl, pak by tento odkaz vedl na 8:3 knihy Jeremjáš.

\mnote{Přečíslování odkazu}
Pokud odkaz směřuje na verš, který má v konkrétním jazykovém překladu odlišné
číslování specifikované makrem `\renum`, pak do odkazu zapište údaj podle
výchozího číslování a \TeX/ si jej sám přepočítá podle dat uvedených v
`\renum`.

\mnote{Údaj ve formě rozsahu}
Údaj (úplný i neúplný) může mít také formát {\em rozsahu}. Toho dosáhnete
tak, že za údaj podle předchozích pravidel připojíte spojovník (znak `-`,
ASCII 45) a pak následuje další `<verš>` nebo `<kapitola>:<verš>`. Příklady:

\begtt \catcode`<=12
<Jr 8:3-7>,
<Jr 8:3-9:5>,
<3-7>,
<8:3-7>.
\endtt
Vytiskne se místo spojovníku automaticky pomlčka. 
Celý takový odkaz umožňuje prokliknout jen na první místo rozsahu, takže
třeba první odkaz z předchozího příkladu se vytiskne jako {\Blue Jr 8:3--7}
a nabízí proklik jen na Jr~8:3.

\mnote{Úsek verše}
Někdy je potřeba odkazovat na úsek verše, nikoli na celý verš. To se dělá
připojením písmene bezprostředně za číslo verše. Například
\begtt \catcode`<=12
... viz <Da 9:11b>
\endtt
Takové písmeno můžete připojit k úplnému i neúplnému odkazu. Pro potřebu
hyperlinku se tato písmena ignorují, ale vytisknou se. Tedy uvedený příklad
vytiskne ... viz {\Blue Da~9:11b} ale proklik vede na Da~9:11.

\mnote{Chybějící číslo verše}
Pokud je v údaji přítomná značka knihy a není přítomná dvojtečka, je
následující číslo interpretováno jako číslo kapitoly, nikoli jako číslo
verše. Například
\begtt \catcode`<=12
... viz <"kapitolu" Da 7>
... Josefův příběh (<Gn 39-41>)
\endtt
\TeX- vytvoří hyperlink na první verš dané kapitoly. Takže uvedený příklad
vytiskne ... viz {\Blue kapitolu Da 7} ... Josefův příběh {\Blue Gn 39--41}
a prokliky vedou na Da~7:1 a na Gn~39:1.

Pokud je značka knihy uvedena v seznamu `\nochapbooks`, pak se číslo za
značkou knihy interpretuje jako číslo verše a ne kapitoly. Existují totiž knihy bez
kapitol. Například chceme, aby \code{<Fm 7>} odkázalo na Fm~1:7 a nikoli na
Fm~7:1. Proto je třeba uvést `Fm` do seznamu `\nochapbooks`. Viz též
sekci~\ref[hlavni].

\mnote{Redukce údajů}
Pravidlo pro tisk odkazů zní: vytiskne se přesně to, co je mezi
závorkami \code{\<} a \code{\>} napsáno (s výjimkou případných znaků \code{"}
uvozujících předsunutý `<text>`). To je ale možné změnit. 
Možná budete chtít do závorek pro odkaz psát úplné údaje a požadovat jejich automatickou 
redukci na neúplné, odkazují-li na aktuální knihu.
Neodkazují-li na aktuální knihu, údaj zůstane úplný. Toho můžete docílit
přidáním `\re` před otevírací závorku údaje (pravidlo případné redukce 
se uplatní jen na tento jediný údaj) nebo pomocí příkazu `\reduceref`. Když jej
použijete v poznámce (nebo v \TeX/ové skupině), pravidlo redukce se uplatní 
pro všechny následující úplné údaje této poznámky (této \TeX/ové skupiny). 
Když jej použijete v deklaraci sazby,
pravidlo případné redukce se uplatní na všechny úplné údaje v dokumentu. 
Příklad:

\begtt \catcode`<=12
\re<"verš" Da 7:3>
\endtt
se vytiskne jako {\Blue verš Da~7:3}, je-li tento odkaz uveden mimo knihu
Daniel. Když je ale tento odkaz uveden v knize Daniel, vytiskne se
jen {\Blue verš~7:3}, který interně odkazuje na Da~7:3. 

Pravidlo redukce odkazů nastavené pomocí `\reduceref` lze vypnout 
příkazem `\noreduceref`. Od něj až do konce poznámky (\TeX/ové skupipny)
se odkazy chovají, jakoby `\reduceref` nebylo zapnuté.

\mnote{Odkazy na poznámky}
Kromě odkazů na verše lze zcela analogicky odkazovat na poznámky k danému
verši. Formát odkazu i pravidla sestavení odkazu jsou stejné, jako u odkazů
na verše. Ale těsně za zavírací závorkou `>` je navíc písmeno `n`, které se
netiskne. Takže třeba

\begtt \catcode`\<=12
... viz <"poznámku" Jr 7:4>n, kde je uvedeno více informací.
\endtt
vytiskne ... viz {\Blue poznámku Jr 7:4}, kde je uvedeno více informací.
Proklik vede na první poznámku k~verši Jr~7:4, nikoli k verši samotnému.

\TODO: Možná analogicky odkazy na glosy a další podobné záležitosti.

\mnote{Odkazy na neexistující místo}
Je-li uveden odkaz na neexistující verš nebo neexistující poznámku, pak
nastanou dvě možnosti. Je-li to odkaz na knihu, která se záměrně netiskne
(protože například pracujeme s testovacím výtiskem jen vybraných knih Bible,
viz též `\printedbooks` v sekci~\ref[hlavni]), pak odkaz je sice obarven,
jakoby byl aktivní, ale aktivní není a v logu při zpracování \TeX/em se
neobjeví žádné varování. Pokud ale odkaz směřuje na neexistující verš nebo
poznámku tištěné části Bible, pak odkaz je aktivní, proklik směřuje na
poslední stránku PDF souboru a v logu se objeví o tom varování, že odkaz
není správný. Při prvním zpracování \TeX/em jsou ale neošetřeny všechny
odkazy a v logu je velké množství varování a nesprávných odkazech.
Teprve při následujícím zpracování \TeX/em jsou odkazy směřující do
existujícího místa správně prolinkovány.

Shrnutí. Odkaz zapisujeme ve formátu
{\def\o{\everyintt{\catcode`\<=13 \Blue}}\Magenta \tt
{\o`\`}\char60{\o`"<text>" <kniha> <kapitola>:`}`<verš>`{\o`-<verš-do>`}\char62{\o`n`}}
kde části vyznačené modře je možné vynechat.

\secc Odkazy na kapitoly a na knihy

Chcete-li odkázat na knihu s proklikem na začátek této knihy, pište
`\cref[<kniha>]`, například `\cref[Gn]` vytiskne {\Blue Gn} s proklikem na
začátek knihy Genesis. Podobně `\cref[Gn 2]` vytiskne {\Blue Gn~2} s~proklikem
na začátek kapitoly Den odpočinutí. Chcete-li vytisknout něco jiného, pak za
údajem `[...]` musí těsně následovat `{<text>}`, kde `<text>` je text, který
se má vytisknout a stát se aktivním odkazem. Takže třeba
`\cref[Gn 2]{Den opdočinutí}` vytiskne {\Blue Den odpočinutí} s proklikem na
odpovídající kapitolu.

\secc Odkazy na stránky

Ve svém textu můžete umístit netištěný cíl odkazu na stránku pomocí `\pglabel[<lejblík>]` a
pak můžete odkazovat na stránku pomocí `\pgref[<lejblík>]`. V místě
`\pgref[<lejblík>]` se vytiskne číslo strany, které je možné prokliknout.
Podobně jako v případě `\cref` se dá pomocí příkazu `\pgref[<lejblík>]{<text>}`
vytisknout jiný `<text>` než číslo strany, který proklikne na místo, kde
je umístěný `\pglabel[<lejblík>]`.


\sec[hlavni] Hlavní soubor s údaji o všech dalších souborech

Hlavní soubor je soubor, který se \TeX/u předloží jako první. Například je
uveden na příkazovém řádku pro spuštění \TeX/u. V něm jsou informace, jaké
další soubory si má \TeX/ přečíst. Nakonec \TeX/ vytvoří soubor PDF stejného
názvu, jako je název hlavního souboru.

Hlavní soubor pro použití OP-Bible může vypadat takto:

\begtt
\load[op-bible]  % macros OP-Bible

\def\tmark     {CzeBKR}            % Variant of translation
\input {sources/\tmark-books.tex}  % Book titles and marks

\def\txsfile   {sources/\tmark-\bmark.txs}     % Localization of .txs files
\def\fmtfile   {formats/fmt-\tmark-\bmark.tex} % Localisation of fmts
\def\notesfile {notes/notes-\bmark.tex}        % Localisation of notes

\def\nochapbooks {Abd Fm 2Jn 3Jn Ju}  % Books without chapters
\def\printedbooks {%
   Gn Ex Lv Nu Dt Joz Sd Rt 1S 2S 1Kr 2Kr 1CPa 2Pa Ezd Neh
   Est Jb Ž Př Kaz Pís Iz Jr Pl Ez Da Oz Jl Am Abd Jon Mi
   Na Abk Sf Ag Za Mal 
   Mt Mk L J Sk Ř 1K 2K Ga Ef Fp Ko 1Te 2Te 1Tm 2Tm 
   Tt Fm Žd Jk 1Pt 2Pt 1J 2J 3J Ju Zj
}
\processbooks % Generates books declared in \printedbooks
\bye
\endtt

Pomocí `\load[op-bible]` načte \TeX/ makra OP-Bible.

`\tmark` je označení překladu, které se používá v názvech dále čtených
souborů. Je nutno je definovat pomocí `\def`. V ukázce je označení pro
český překlad podle Bible Kralické.

`\input {sources/\tmark-books.tex}` přečte soubor, kde jsou pomocí
`\BookTitle` deklarovány potřebné vazby mezi `<b-značkou>`, `<a-značkou>` a
titulem knihy. Formát příkazu `\BookTilte` je následující:

\begtt
\BookTitle <b-značka> <a-značka> {<titul knihy>}
\endtt
Začátek takto čteného souboru může vypadat třeba takto:

\begtt
\BookTitle Gen  Gn  {První Mojžíšova (Genesis)}
\BookTitle Exod Ex  {Druhá Mojžíšova (Exodus)}
\BookTitle Lev  Lv  {Třetí Mojžíšova (Levicitus)}
\BookTitle Num  Nu  {Čtvrtá Mojžíšova (Numeri)}
\BookTitle Deut Dt  {Pátá Mojžíšova (Deuteronomium)}
\BookTitle Josh Joz {Jozue}
\BookTitle Judg Sd  {Soudců}
...
\endtt
V prvním sloupci za `BookTitle` je `<b-značka>`, která je dále používána v
názvech souborů jako `\bmark`. Ve druhém sloupci je `<a-značka>`, tedy
aktuální značka knihy, která je používána v konkrétním překladu a bude
použita v textu knihy například při sestavování obsahu či v odkazech. V ukázce
máme český překlad, tj. `<a-značka>` knihy Soudců je Sd, zatímco `<b-značka>`
je Judg. Pro názvy souborů se doporučuje ponechat anglické značky, 
abychom nemuseli mít v názvech souborů např. české znaky, takže číst se bude
soubor v jehož názvu je Judg, protože taková je zde <b-značka>, zatímco v
textu Bible bude tato kniha Soudců označena jako Sd.

Soubor s 66 údaji `\BookTitle` je připraven po extrakci základních textů z
Swordu pomocí `mod2tex` a `maketxs`. Je možné je použít, ovšem `<a-značky>`
a tituly knih je potřeba manuálně upravit podle zvyklostí daného překladu,
jak je předvedeno v ukázce výše. 

Do tohoto souboru je možné přidat další informace o jednotlivých knihách
pomocí příkazů `\BookException`, `\BookPre`, `\BookPost`, viz ...\TODO

Pokud chcete mít v názvech souborů <a-značky>, je to možné, ale doporučuje
se kromě toho použít následující sadu výjimek, které odstraňují diakritiku
z~`\amark` v názvech souborů, ale ponechávají ji v textech Bible:

\begtt
\BookException Ž   {\def\amark{Z}}
\BookException Př  {\def\amark{Pr}}
\BookException Pís {\def\amark{Pis}}
\BookException Ř   {\def\amark{R}}
\BookException Žd  {\def\amark{Zd}}
\endtt

Je také možné mít některé typy souborů pojmenované podle <b-značky> a jiné
podle <a-značky>, například:

\begtt
\def\txsfile   {sources/\tmark-\bmark.txs}        % Localization of .txs files
\def\fmtfile   {formats/fmt-\tmark-\amark.tex}    % Localisation of fmts
\def\notesfile {notes/notes-\amark.tex}           % Localisation of notes
\endtt

`\txsfile` deklaruje umístění základních textů Bible, tedy `.txs` souborů,
viz sekci~\ref[zakladni]. V umístění může být specifikován adresář (v ukázce
je `sources/`) a názvy souborů mohou obsahovat `\tmark`, což se nahradí
definovaným označením překladu a dále by měl obsahovat `\bmark`, což se
nahradí `<b-značkou>` knihy. 

`\fmtfile` deklaruje umístění souborů s formátovacími pokyny. Jejich smysl
je vyložen v sekci~\ref[fmt].

`\notesfile` deklaruje umístění souborů s texty poznámek. Jejich formát je
popsán v sekci~\ref[note].

`\nochapbooks` obsahuje `<a-značky>` knih, které nemají kapitoly. Odkazy
na tyto knihy se tvoří jiným způsobem než odkazy na knihy s kapitolami, viz
sekci~\ref[odkazy].

`\printedbooks` obsahuje `<a-značky>` těch knih, které chcete \TeX/em zpracovat.
Pokud děláte třeba jen testovací tisky, můžete zpracovat jen některé
biblické knihy a mít tedy alternativní definici, například
`\def\printedbooks{Da}`.

`\processbooks` spustí cyklus přes všechny biblické knihy podle jejich `<a-značek>`
uložených v~`\printedbooks`. Pro každou takovou knihu \TeX/ nejprve
načte soubor s poznámkami (umístěný podle `\notesfile`), dále přečte soubor
s formátovacími údaji (umístěný podle `fmtfile`) a data z~těchto souborů si
uloží přechodně do paměti. Konečně \TeX/ přečte základní
text umístěný v `\txsfile` a vytvoří sazbu tohoto textu společně s
poznámkami podle stanovených formátovacích pokynů. 

Před provedením `\processbook` je možné pomocí `\input` načít další makra,
která nějakým způsobem ovlivní sazbu výsledné Bible. 

\sec Způsob zpracování \TeX/em

...

\bye
